<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login / Register - PerpustakaanKu</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div class="page">
      <header>
        <div class="container nav">
          <a class="logo" href="./index.html">Perpustakaan Politeknik Negeri Medan</a>
         
        </div>
      </header>

      <main class="container" style="flex: 1;">
        <section class="card form-card">
          <h1 style="margin-bottom: 8px;">Masuk dengan Email</h1>
          <p class="muted" style="margin-bottom: 24px;">
            Masukkan email dan password Anda untuk mengakses peminjaman buku. Jika belum memiliki akun, ajukan melalui admin terlebih dahulu.
          </p>
          <form id="loginForm" class="auth-form">
            <div id="errorMessage" class="alert alert-danger" role="alert" style="display: none; margin-bottom: 16px;"></div>
            <div>
              <label for="email">Email</label>
              <input
                id="email"
                type="email"
                name="email"
                placeholder="contoh: nama@email.com"
                autocomplete="email"
                required
              />
              <small class="muted">Gunakan email yang sudah terdaftar dan diterima oleh admin.</small>
            </div>
            <div>
              <label for="password">Password</label>
              <input
                id="password"
                type="password"
                name="password"
                placeholder="masukkan password"
                autocomplete="current-password"
                required
              />
            </div>
            <button class="btn btn-primary w-100" type="submit" id="submitBtn">Masuk dengan Email</button>
            <div class="auth-helper" style="justify-content: center;">
              <span class="muted" style="font-size: 0.85rem;">Belum punya akun?</span>
              <a class="btn btn-outline" style="padding: 8px 16px;" href="./request-login.html">Ajukan Akun</a>
            </div>
          </form>
        </section>

       
      <footer>
        <div class="container">Â© 2025 Perpustakaan Politeknik Negeri Medan</div>
      </footer>
    </div>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <script>
    (function () {
      const loginForm = document.getElementById('loginForm');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const submitBtn = document.getElementById('submitBtn');
      const errorMessage = document.getElementById('errorMessage');

      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
      }

      function hideError() {
        errorMessage.style.display = 'none';
      }

      loginForm?.addEventListener('submit', async (event) => {
        event.preventDefault();
        hideError();

        if (!loginForm.checkValidity()) {
          loginForm.reportValidity();
          return;
        }

        const email = emailInput.value.trim().toLowerCase();
        const password = passwordInput.value;

        // Disable button dan show loading
        submitBtn.disabled = true;
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Memproses...';

        try {
          const formData = new FormData();
          formData.append('email', email);
          formData.append('password', password);

          const response = await fetch('./login-api.php', {
            method: 'POST',
            body: formData
          });

          const data = await response.json();

          if (data.success) {
            // Simpan informasi user
            localStorage.setItem('userLoginNumber', data.user.username);
            localStorage.setItem('userEmail', data.user.email);
            localStorage.setItem('userName', data.user.nama);
            localStorage.setItem('userId', data.user.id);
            localStorage.setItem('userLoginMethod', 'email');
            
            // Redirect ke halaman buku
            window.location.href = './books.html';
          } else {
            showError(data.message || 'Email atau password salah');
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        } catch (error) {
          console.error('Error:', error);
          showError('Terjadi kesalahan saat login. Pastikan koneksi internet Anda stabil.');
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      });
    })();
  </script>
</html>

