<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perpustakaan Digital - Beranda</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div class="page">
      <header>
        <div class="container nav">
          <a class="logo" href="#">Perpustakaan Politeknik Negeri Medan</a>
          <div class="search-bar">
            <svg width="18" height="18" fill="none" stroke="#94a3b8">
              <circle cx="8" cy="8" r="7" stroke-width="2"></circle>
              <line x1="13" y1="13" x2="17" y2="17" stroke-width="2"></line>
            </svg>
            <input type="text" placeholder="Cari judul, penulis, atau kategori..." />
          </div>
          <a class="btn btn-primary" href="./login.html">Login</a>
        </div>
      </header>

      <main class="container">
        <section class="hero">
          <div>
            <h1>Selamat datang di Perpustakaan Politeknik Negeri Medan</h1>
            <p>
              Jelajahi ribuan koleksi buku terbaik, pinjam secara daring, dan kelola riwayat
              peminjaman Anda dengan mudah dalam satu platform.
            </p>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <a class="btn btn-primary" href="./login.html">Jelajahi Buku</a>
              <a class="btn btn-outline" href="./login.html">Dashboard Saya</a>
            </div>
          </div>
          <div class="hero-img">
            <img
              src="https://images.unsplash.com/photo-1512820790803-83ca734da794?auto=format&fit=crop&w=500&q=60"
              alt="Rak buku"
            />
          </div>
        </section>

        <section class="section">
          <div class="section-header">
            <h2>Buku Terbaru</h2>
            <a class="btn btn-outline" href="./login.html">Lihat Semua</a>
          </div>
          <div class="grid grid-4" id="latestBooks">
            <p class="muted" style="grid-column: 1 / -1; text-align: center; padding: 24px;">
              Memuat data...
            </p>
          </div>
        </section>

        <section class="section">
          <div class="section-header">
            <h2>Kategori Populer</h2>
          </div>
          <div class="categories" id="popularCategories">
            <p class="muted" style="text-align: center; padding: 24px;">Memuat data...</p>
          </div>
        </section>
      </main>

      <footer>
        <div class="container">
          © 2025 Perpustakaan Politeknik Negeri Medan · Mudah, cepat, modern
        </div>
      </footer>
    </div>
  </body>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>

  <script>
    (function () {
      function coverUrl(cover, index, fallbacks) {
        if (cover) {
          const normalized = cover.startsWith('/') ? cover.substring(1) : cover;
          return '../' + normalized;
        }
        return fallbacks[index % fallbacks.length];
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // Load data dari API
      fetch('./index-api.php')
        .then(response => response.json())
        .then(data => {
          if (!data.success) {
            console.error('Error loading data');
            return;
          }

          // Render buku terbaru
          const booksContainer = document.getElementById('latestBooks');
          if (data.books.length === 0) {
            booksContainer.innerHTML =
              '<p class="muted" style="grid-column: 1 / -1; text-align: center; padding: 24px;">Belum ada buku yang tersedia.</p>';
          } else {
            booksContainer.innerHTML = data.books
              .map((book, index) => {
                const available = book.stok > 0;
                const cover = coverUrl(book.cover, index, data.placeholders);

                // Tombol Pinjam → Selalu menuju login.html
                return `
                  <article class="card">
                    <img class="book-cover" src="${escapeHtml(cover)}" alt="Cover buku" />
                    <h3>${escapeHtml(book.judul)}</h3>
                    <p class="muted">${escapeHtml(book.penulis)} · ${book.tahun}</p>
                    <div class="book-tags">
                      <span class="chip chip-info">${escapeHtml(book.kategori)}</span>
                      <span class="chip ${
                        available ? 'chip-success' : 'chip-danger'
                      }">${available ? 'Tersedia' : 'Habis'}</span>
                    </div>
                    <a class="btn ${available ? 'btn-primary' : 'btn-outline'}" href="./login.html">
                      ${available ? 'Pinjam' : 'Antri'}
                    </a>
                  </article>
                `;
              })
              .join('');
          }

          // Render kategori populer
          const categoriesContainer = document.getElementById('popularCategories');
          if (data.categories.length === 0) {
            categoriesContainer.innerHTML =
              '<p class="muted" style="text-align: center; padding: 24px;">Belum ada kategori populer.</p>';
          } else {
            categoriesContainer.innerHTML = data.categories
              .map(cat => {
                return `
                  <div class="card category-card">
                    <h3>${escapeHtml(cat.kategori)}</h3>
                    <p>${cat.total_buku} buku · ${cat.jumlah_peminjaman} peminjaman</p>
                  </div>
                `;
              })
              .join('');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById(
            'latestBooks'
          ).innerHTML = '<p class="muted" style="grid-column: 1 / -1; text-align: center; padding: 24px;">Gagal memuat data.</p>';
          document.getElementById(
            'popularCategories'
          ).innerHTML = '<p class="muted" style="text-align: center; padding: 24px;">Gagal memuat data.</p>';
        });
    })();
  </script>
</html>

